-- Delete students with the following phone numbers
-- This query handles phone number variations (with/without leading 0, with/without +251)

-- First, let's see what we're about to delete
SELECT 'Students to be deleted' as type, id, username, phone, full_name_english, appointment_id 
FROM students 
WHERE phone IN (
  '0900619929',
  '0964044572',
  '0933335066',
  '0975943784',
  '0913070111',
  '0982487576',
  '0902902081',
  '0987227416',
  '0984147284',
  '0929553297',
  '0934234973',
  '919342702',
  '927171232',
  '0923757685',
  '0943303670',
  '+251943790597',
  '0965267260',
  '0992740397',
  '0920193686'
)
OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
  '0900619929',
  '0964044572',
  '0933335066',
  '0975943784',
  '0913070111',
  '0982487576',
  '0902902081',
  '0987227416',
  '0984147284',
  '0929553297',
  '0934234973',
  '0919342702',  -- normalized from 919342702
  '0927171232',  -- normalized from 927171232
  '0923757685',
  '0943303670',
  '0943790597',  -- normalized from +251943790597
  '0965267260',
  '0992740397',
  '0920193686'
)
OR RIGHT(REGEXP_REPLACE(phone, '[^0-9]', '', 'g'), 9) IN (
  '900619929',
  '964044572',
  '933335066',
  '975943784',
  '913070111',
  '982487576',
  '902902081',
  '987227416',
  '984147284',
  '929553297',
  '934234973',
  '19342702',   -- last 9 digits from 919342702
  '27171232',   -- last 9 digits from 927171232
  '923757685',
  '943303670',
  '943790597',  -- from +251943790597
  '965267260',
  '992740397',
  '920193686'
);

-- Check related appointments
SELECT 'Related Appointments' as type, id, applicant_name, applicant_phone, scheduled_date, final_decision
FROM appointments
WHERE applicant_phone IN (
  '0900619929',
  '0964044572',
  '0933335066',
  '0975943784',
  '0913070111',
  '0982487576',
  '0902902081',
  '0987227416',
  '0984147284',
  '0929553297',
  '0934234973',
  '919342702',
  '927171232',
  '0923757685',
  '0943303670',
  '+251943790597',
  '0965267260',
  '0992740397',
  '0920193686'
)
OR REGEXP_REPLACE(applicant_phone, '[^0-9]', '', 'g') IN (
  '0900619929',
  '0964044572',
  '0933335066',
  '0975943784',
  '0913070111',
  '0982487576',
  '0902902081',
  '0987227416',
  '0984147284',
  '0929553297',
  '0934234973',
  '0919342702',
  '0927171232',
  '0923757685',
  '0943303670',
  '0943790597',
  '0965267260',
  '0992740397',
  '0920193686'
);

-- ============================================
-- ACTUAL DELETION QUERIES (Run after verification)
-- ============================================

BEGIN;

-- 1. Delete assignment submissions for students with these phones
DELETE FROM assignment_submissions 
WHERE student_id IN (
  SELECT id FROM students 
  WHERE phone IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '919342702', '927171232', '0923757685', '0943303670',
    '+251943790597', '0965267260', '0992740397', '0920193686'
  )
  OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
    '0943790597', '0965267260', '0992740397', '0920193686'
  )
);

-- 2. Delete payments for students with these phones
DELETE FROM payments 
WHERE student_id IN (
  SELECT id FROM students 
  WHERE phone IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '919342702', '927171232', '0923757685', '0943303670',
    '+251943790597', '0965267260', '0992740397', '0920193686'
  )
  OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
    '0943790597', '0965267260', '0992740397', '0920193686'
  )
);

-- 3. Delete attendance records for students with these phones
DELETE FROM attendance 
WHERE student_id IN (
  SELECT id FROM students 
  WHERE phone IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '919342702', '927171232', '0923757685', '0943303670',
    '+251943790597', '0965267260', '0992740397', '0920193686'
  )
  OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
    '0943790597', '0965267260', '0992740397', '0920193686'
  )
);

-- 4. Delete team memberships for students with these phones
DELETE FROM team_memberships 
WHERE student_id IN (
  SELECT id FROM students 
  WHERE phone IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '919342702', '927171232', '0923757685', '0943303670',
    '+251943790597', '0965267260', '0992740397', '0920193686'
  )
  OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
    '0943790597', '0965267260', '0992740397', '0920193686'
  )
);

-- 5. Delete prayer slots for students with these phones
DELETE FROM prayer_slots 
WHERE claimed_by_id IN (
  SELECT id FROM students 
  WHERE phone IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '919342702', '927171232', '0923757685', '0943303670',
    '+251943790597', '0965267260', '0992740397', '0920193686'
  )
  OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
    '0943790597', '0965267260', '0992740397', '0920193686'
  )
);

-- 6. Delete notes authored by students with these phones
DELETE FROM notes 
WHERE author_id IN (
  SELECT id FROM students 
  WHERE phone IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '919342702', '927171232', '0923757685', '0943303670',
    '+251943790597', '0965267260', '0992740397', '0920193686'
  )
  OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
    '0943790597', '0965267260', '0992740397', '0920193686'
  )
);

-- 7. Delete notices for students with these phones
DELETE FROM notices 
WHERE target_student_id IN (
  SELECT id FROM students 
  WHERE phone IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '919342702', '927171232', '0923757685', '0943303670',
    '+251943790597', '0965267260', '0992740397', '0920193686'
  )
  OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
    '0943790597', '0965267260', '0992740397', '0920193686'
  )
);

-- 8. Delete interview evaluations for appointments with these phones
DELETE FROM interview_evaluations 
WHERE appointment_id IN (
  SELECT id FROM appointments 
  WHERE applicant_phone IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '919342702', '927171232', '0923757685', '0943303670',
    '+251943790597', '0965267260', '0992740397', '0920193686'
  )
  OR REGEXP_REPLACE(applicant_phone, '[^0-9]', '', 'g') IN (
    '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
    '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
    '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
    '0943790597', '0965267260', '0992740397', '0920193686'
  )
);

-- 9. Delete students with these phones
DELETE FROM students 
WHERE phone IN (
  '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
  '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
  '0934234973', '919342702', '927171232', '0923757685', '0943303670',
  '+251943790597', '0965267260', '0992740397', '0920193686'
)
OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
  '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
  '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
  '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
  '0943790597', '0965267260', '0992740397', '0920193686'
);

-- 10. Delete appointments with these phones
DELETE FROM appointments 
WHERE applicant_phone IN (
  '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
  '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
  '0934234973', '919342702', '927171232', '0923757685', '0943303670',
  '+251943790597', '0965267260', '0992740397', '0920193686'
)
OR REGEXP_REPLACE(applicant_phone, '[^0-9]', '', 'g') IN (
  '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
  '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
  '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
  '0943790597', '0965267260', '0992740397', '0920193686'
);

COMMIT;

-- Verification after deletion
SELECT 'Remaining students count' as type, COUNT(*) as count
FROM students 
WHERE phone IN (
  '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
  '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
  '0934234973', '919342702', '927171232', '0923757685', '0943303670',
  '+251943790597', '0965267260', '0992740397', '0920193686'
)
OR REGEXP_REPLACE(phone, '[^0-9]', '', 'g') IN (
  '0900619929', '0964044572', '0933335066', '0975943784', '0913070111',
  '0982487576', '0902902081', '0987227416', '0984147284', '0929553297',
  '0934234973', '0919342702', '0927171232', '0923757685', '0943303670',
  '0943790597', '0965267260', '0992740397', '0920193686'
);



